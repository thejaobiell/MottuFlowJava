<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Funcionários</title>
    <link rel="stylesheet" th:href="@{/css/listar-cadastrar-delete.css}">
    <link rel="stylesheet" th:href="@{/css/components/header.css}">
    <link rel="stylesheet" th:href="@{/css/components/footer.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@400;500;700&display=swap" rel="stylesheet">
	<link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}">
</head>
<body>
    <div th:replace="~{components/header :: header}"></div>

	<main>
	    <h2>Gerenciar Funcionários</h2>
		
	    <section>
		    <form th:action="@{/funcionarios/cadastrar}" method="post">
		
		        <label for="nome">Nome</label>
		        <input id="nome" type="text" name="nome" placeholder="Nome" required>
		
		        <label for="email">Email</label>
		        <input id="email" type="email" name="email" placeholder="Email" required>
		
		        <label for="cpf">CPF</label>
		        <input id="cpf" type="text" name="cpf" maxlength="14" placeholder="000.000.000-00" required>
		
		        <label for="telefone">Telefone</label>
		        <input id="telefone" type="text" name="telefone" maxlength="15" placeholder="(00) 00000-0000" required>
		
		        <label for="cargo">Cargo</label>
		        <select id="cargo" name="cargo" required>
		            <option value="">Selecione o Cargo</option>
		            <option value="MECANICO">Mecânico</option>
		            <option value="GERENTE">Gerente</option>
		            <option value="ADMIN">Admin</option>
		        </select>
		
		        <label for="senha">Senha</label>
		        <input id="senha" type="password" name="senha" placeholder="Senha" required>
		
		        <button type="submit">Cadastrar</button>
		    </form>
		</section>

		
	    <section>
	        <table>
	            <thead>
	                <tr>
	                    <th>Nome</th>
	                    <th>Email</th>
	                    <th>CPF</th>
	                    <th>Telefone</th>
	                    <th>Cargo</th>
	                    <th class="actions">Ações</th>
	                </tr>
	            </thead>
	            <tbody>
	                <tr th:each="func : ${funcionarios}">
	                    <td th:text="${func.nome}">Nome</td>
	                    <td th:text="${func.email}">email@exemplo.com</td>
	                    <td th:text="${func.cpf}">000.000.000-00</td>
	                    <td th:text="${func.telefone}">(00) 00000-0000</td>
	                    <td th:text="${func.cargo}">Cargo</td>
	                    <td class="actions">
						    <a th:href="@{'/funcionarios/editar/' + ${func.id_funcionario}}" class="button edit">Editar</a>
						    <form th:action="@{'/funcionarios/deletar/' + ${func.id_funcionario}}" method="post" style="display:block; margin-top:5px;"
						          onsubmit="return confirm('Tem certeza que deseja deletar este funcionário?')">
						        <button type="submit" class="button delete">Deletar</button>
						    </form>
						</td>
	                </tr>
	            </tbody>
	        </table>
	    </section>
	</main>

    <div th:replace="~{components/footer :: footer}"></div>

    <script>
        document.getElementById('cpf').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, ''); // remove tudo que não é número
            if (value.length > 11) value = value.substring(0, 11);

            let formatted = value;
            if (value.length > 9) {
                formatted = value.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/, "$1.$2.$3-$4");
            } else if (value.length > 6) {
                formatted = value.replace(/(\d{3})(\d{3})(\d{0,3})/, "$1.$2.$3");
            } else if (value.length > 3) {
                formatted = value.replace(/(\d{3})(\d{0,3})/, "$1.$2");
            }
            e.target.value = formatted;
        });

        document.getElementById('telefone').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, ''); // só números
            if (value.length > 11) value = value.substring(0, 11);

            let formatted = value;
            if (value.length > 10) {
                formatted = value.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
            } else if (value.length > 6) {
                formatted = value.replace(/(\d{2})(\d{4})(\d{0,4})/, "($1) $2-$3");
            } else if (value.length > 2) {
                formatted = value.replace(/(\d{2})(\d{0,5})/, "($1) $2");
            } else {
                formatted = value.replace(/(\d*)/, "($1");
            }
            e.target.value = formatted;
        });
    </script>
</body>
</html>